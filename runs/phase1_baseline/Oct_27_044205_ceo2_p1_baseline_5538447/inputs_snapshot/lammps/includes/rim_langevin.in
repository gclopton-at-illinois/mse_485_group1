# rim_langevin.in — robust x–y rim sponge (units metal)
# Expects: RIM_WIDTH_NM (nm), RIM_GAMMA (ps^-1), RIM_TK (K) via -var

# Local RNG seed (kept distinct to avoid collisions)
variable rim_seed equal 98765

# Convert rim width to Å
variable rim_wA   equal ${RIM_WIDTH_NM}*10.0

# Capture box bounds into local variables (numbers)
variable bxlo     equal xlo
variable bxhi     equal xhi
variable bylo     equal ylo
variable byhi     equal yhi

# Precompute slab faces (avoid spaces in expressions)
variable bxlo_hi  equal v_bxlo+v_rim_wA
variable bxhi_lo  equal v_bxhi-v_rim_wA
variable bylo_hi  equal v_bylo+v_rim_wA
variable byhi_lo  equal v_byhi-v_rim_wA

# Four x/y edge slabs; thickness = rim_wA
region rim_xlo block v_bxlo    v_bxlo_hi  INF INF INF INF units box
region rim_xhi block v_bxhi_lo v_bxhi     INF INF INF INF units box
region rim_ylo block INF INF   v_bylo     v_bylo_hi  INF INF units box
region rim_yhi block INF INF   v_byhi_lo  v_byhi     INF INF units box

# Union them into a single region, then define the rim group from that region
region rim_union union 4 rim_xlo rim_xhi rim_ylo rim_yhi
group  rim region rim_union

# ---- Rim thermostat (x/y only; z stays periodic) ----
# Use tau = 1/gamma (LAMMPS expects a damping time), zero net momentum, and TALLY the energy exchange.
variable rim_tau_ps equal 1.0/${RIM_GAMMA}
fix f_rim rim langevin ${RIM_TK} ${RIM_TK} ${rim_tau_ps} ${rim_seed} zero yes tally yes

# ---- Geometry sanity print (distance from axis vs. r0) ----
# Minimum rim distance from the box center (in Å):
variable LxA equal ${bxhi}-${bxlo}
variable LyA equal ${byhi}-${bylo}
variable halfminA equal 0.5*min(v_LxA,v_LyA)
variable r_rim_start_A equal v_halfminA - v_rim_wA

# If R0 (nm) is being passed to this input, we can warn if the rim intrudes near the source core
# (3× R0 is a conservative “no-reflection” margin for Phase 1). This is a print-only check.
variable r0A equal ${R0}*10.0
variable ok_margin equal v_r_rim_start_A - 3.0*v_r0A

print "rim_langevin: x=[${bxlo},${bxhi}] y=[${bylo},${byhi}] rim_wA=${rim_wA}  r_rim_start_A=${r_rim_start_A}" screen yes
if "${ok_margin} < 0.0" then &
  "print 'WARNING: rim may be too close to the heated core (r_rim_start < 3*r0). Consider reducing RIM_WIDTH_NM or enlarging the box.' screen yes"
